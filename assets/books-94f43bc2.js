import{b as Z,i as ee,u as ae,E as L,_ as oe,w as le,D as te,G as ne}from"./base-bb3a9cd4.js";import{E as se,a as re,g as ue,b as ie,c as de,e as pe,h as me}from"./table-column-f50dbfa4.js";import{b as fe,E as be,a as ce,c as _e}from"./input-0dfebaa5.js";import"./scrollbar-cd73b27d.js";import"./popper-f3ef1ed3.js";import{E as ke}from"./pagination-07fe6fb6.js";import"./tooltip-15a256c2.js";import{E as b,a as ve}from"./text-f58459f4.js";/* empty css             */import{d as B,l as ge,b as c,c as U,i as z,w as l,L as ye,k as w,M as I,I as P,j as T,r as f,o as Ve,e as y,f as e,g as r,J as $,F as J,K as we,z as Ce,A as Ee,u as he,a as V}from"./index-7c7dea94.js";import"./aria-60e0cdc6.js";const Ne=Z({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:ee}}),Ie={click:C=>C instanceof MouseEvent},Ue=["href","target"],De=B({name:"ElLink"}),Se=B({...De,props:Ne,emits:Ie,setup(C,{emit:D}){const i=C,d=ae("link"),E=ge(()=>[d.b(),d.m(i.type),d.is("disabled",i.disabled),d.is("underline",i.underline&&!i.disabled)]);function _(n){i.disabled||D("click",n)}return(n,k)=>(c(),U("a",{class:P(w(E)),href:n.disabled||!n.href?void 0:n.href,target:n.disabled||!n.href?void 0:n.target,onClick:_},[n.icon?(c(),z(w(L),{key:0},{default:l(()=>[(c(),z(ye(n.icon)))]),_:1})):I("v-if",!0),n.$slots.default?(c(),U("span",{key:1,class:P(w(d).e("inner"))},[T(n.$slots,"default")],2)):I("v-if",!0),n.$slots.icon?T(n.$slots,"icon",{key:2}):I("v-if",!0)],10,Ue))}});var xe=oe(Se,[["__file","link.vue"]]);const $e=le(xe);const ze={style:{display:"flex","flex-direction":"column",height:"100%"}},Be={style:{display:"flex",gap:"8px",padding:"8px"}},Oe=["src"],Ae={style:{"text-wrap":"nowrap"}},Pe={style:{flex:"auto"}},Qe=B({__name:"books",setup(C){const D=he(),i=f(1),d=f(10),E=f(0),_=f([{author:"",bookCategories:0,bookDescription:"",bookImg:"",bookName:"",bookUrl:"",createAdminer:0,displayOrder:0,id:0,permission:0,status:0,updateAdminer:0}]),n=f(!1),k=f("new"),t=f({author:"",bookCategories:0,bookDescription:"",bookImg:"",bookName:"",bookUrl:"",id:0,permission:0,status:0}),S=f([{categoryName:"dummy",id:1}]);function F(){k.value="new",t.value={author:"",bookCategories:0,bookDescription:"",bookImg:"",bookName:"",bookUrl:"",id:0,permission:0,status:0},n.value=!0}function M(s){var o=JSON.parse(JSON.stringify(_.value[s]));delete o.createAdminer,delete o.displayOrder,delete o.updateAdminer,t.value=o,k.value="update",n.value=!0}function x(){n.value=!1}function j(){if(k.value=="new"){var s=JSON.parse(JSON.stringify(t.value));delete s.id,V.post("/admin/book/add",s).then(o=>{o.data.code==1?(x(),v(),b.success("保存成功")):b.error(`保存失败: ${o.data.msg}`)})}else k.value=="update"&&V.put("/admin/book/update",t.value).then(o=>{o.data.code==1?(x(),v(),b.success("保存成功")):b.error(`保存失败: ${o.data.msg}`)})}function R(s){var o=_.value[s].id;V.delete("/admin/book/delete",{params:{ids:o}}).then(m=>{m.data.code==1?(v(),b.success("删除成功")):b.error(`删除失败: ${m.data.msg}`)})}function v(){V.post("/admin/book/getbookInfo",{pageNo:i.value,pageSize:d.value}).then(s=>{if(s.data.data===null){D.push("/login");return}_.value=s.data.records,E.value=s.data.total}).catch(()=>{b.error("数据加载失败")}),V.get("/admin/bookcategory/getcategoryInfo").then(s=>{S.value=s.data.data})}return Ve(()=>{v()}),(s,o)=>{const m=fe,u=se,G=L,K=$e,O=ve,q=re,H=ke,g=be,p=ce,Q=me,W=ue,h=ie,A=de,X=_e,Y=pe;return c(),U(J,null,[y("div",ze,[y("div",Be,[e(m,{type:"primary",icon:w(te),onClick:F},{default:l(()=>[r("新增书籍")]),_:1},8,["icon"])]),e(q,{data:_.value,"table-layout":"auto"},{default:l(()=>[e(u,{prop:"id",label:"ID"}),e(u,{prop:"bookImg",label:"封面"},{default:l(a=>[y("img",{style:{"max-width":"96px","max-height":"96px"},src:a.row.bookImg},null,8,Oe)]),_:1}),e(u,{prop:"bookName",label:"书名"}),e(u,{prop:"author",label:"作者"}),e(u,{prop:"bookCategories",label:"分类"},{default:l(a=>[r($((()=>{for(let N of S.value)if(N.id==a.row.bookCategories)return N.categoryName})()),1)]),_:1}),I("",!0),e(u,{prop:"bookUrl",label:"链接"},{default:l(a=>[e(K,{type:"primary",href:a.row.bookUrl,target:"_blank"},{default:l(()=>[r(" 打开 "),e(G,null,{default:l(()=>[e(w(ne))]),_:1})]),_:2},1032,["href"])]),_:1}),e(u,{prop:"displayOrder",label:"排序"}),e(u,{prop:"permission",label:"会员专享"},{default:l(a=>[e(O,{tag:a.row.permission==1?"b":"span"},{default:l(()=>[r($(a.row.permission==1?"是":"否"),1)]),_:2},1032,["tag"])]),_:1}),e(u,{prop:"status",label:"上架状态"},{default:l(a=>[e(O,{type:a.row.status==1?"success":"danger"},{default:l(()=>[r($(a.row.status==1?"已上架":"未上架"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"createAdminer",label:"创建人"}),e(u,{prop:"updateAdminer",label:"修改人"}),e(u,{label:"操作",fixed:"right"},{default:l(a=>[y("div",Ae,[e(m,{link:"",type:"primary",size:"small",onClick:N=>M(a.$index)},{default:l(()=>[r("编辑")]),_:2},1032,["onClick"]),e(m,{link:"",type:"primary",size:"small",onClick:N=>R(a.$index)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),e(H,{style:{padding:"8px"},"current-page":i.value,"onUpdate:currentPage":o[0]||(o[0]=a=>i.value=a),"page-size":d.value,"onUpdate:pageSize":o[1]||(o[1]=a=>d.value=a),"page-sizes":[10,25,50,100],layout:"total, sizes, prev, pager, next, jumper",total:E.value,onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),e(Y,{modelValue:n.value,"onUpdate:modelValue":o[11]||(o[11]=a=>n.value=a),title:`编辑 "${t.value.bookName}"`},{footer:l(()=>[y("div",Pe,[e(m,{onClick:x},{default:l(()=>[r("取消")]),_:1}),e(m,{type:"primary",onClick:j},{default:l(()=>[r("保存")]),_:1})])]),default:l(()=>[e(X,{"label-width":"auto","label-position":"left",model:t.value},{default:l(()=>[e(p,{label:"书名"},{default:l(()=>[e(g,{modelValue:t.value.bookName,"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.bookName=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"封面"},{default:l(()=>[e(g,{modelValue:t.value.bookImg,"onUpdate:modelValue":o[3]||(o[3]=a=>t.value.bookImg=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"作者"},{default:l(()=>[e(g,{modelValue:t.value.author,"onUpdate:modelValue":o[4]||(o[4]=a=>t.value.author=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"分类"},{default:l(()=>[e(W,{modelValue:t.value.bookCategories,"onUpdate:modelValue":o[5]||(o[5]=a=>t.value.bookCategories=a)},{default:l(()=>[(c(!0),U(J,null,we(S.value,a=>(c(),z(Q,{label:a.categoryName,value:a.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"介绍"},{default:l(()=>[e(g,{modelValue:t.value.bookDescription,"onUpdate:modelValue":o[6]||(o[6]=a=>t.value.bookDescription=a),type:"textarea",autosize:""},null,8,["modelValue"])]),_:1}),e(p,{label:"链接"},{default:l(()=>[e(g,{modelValue:t.value.bookUrl,"onUpdate:modelValue":o[7]||(o[7]=a=>t.value.bookUrl=a)},null,8,["modelValue"])]),_:1}),e(p,{label:"会员专享"},{default:l(()=>[e(A,{modelValue:t.value.permission,"onUpdate:modelValue":o[8]||(o[8]=a=>t.value.permission=a)},{default:l(()=>[e(h,{label:0},{default:l(()=>[r("否")]),_:1}),e(h,{label:1},{default:l(()=>[r("是")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"上架状态"},{default:l(()=>[e(A,{modelValue:t.value.status,"onUpdate:modelValue":o[9]||(o[9]=a=>t.value.status=a)},{default:l(()=>[e(h,{label:0},{default:l(()=>[r("未上架")]),_:1}),e(h,{label:1},{default:l(()=>[r("已上架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),Ce(e(p,{label:"ID"},{default:l(()=>[e(g,{modelValue:t.value.id,"onUpdate:modelValue":o[10]||(o[10]=a=>t.value.id=a)},null,8,["modelValue"])]),_:1},512),[[Ee,k.value=="update"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}});export{Qe as default};
