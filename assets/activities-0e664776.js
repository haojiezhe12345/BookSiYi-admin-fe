import{D as G}from"./base-bb3a9cd4.js";import{h as P,g as K,E as L,a as Q,b as W,c as X,e as Z}from"./table-column-f50dbfa4.js";import{b as j,E as ee,a as le,c as ae}from"./input-0dfebaa5.js";import{E as te}from"./date-picker-844a3b3d.js";import"./scrollbar-cd73b27d.js";import"./popper-f3ef1ed3.js";import"./tooltip-15a256c2.js";import{E as p,a as oe}from"./text-f58459f4.js";import{d as ie,r as f,o as de,b as ue,c as ne,e as g,f as e,w as t,g as u,k as w,J as U,z as E,A as D,F as re,u as me,a as V}from"./index-7c7dea94.js";import{a as k,t as C}from"./utils-d837aa94.js";import"./aria-60e0cdc6.js";const se={style:{display:"flex","flex-direction":"column",height:"100%"}},pe={style:{display:"flex",gap:"8px",padding:"8px"}},fe={style:{"text-wrap":"nowrap"}},_e={style:{flex:"auto"}},he=ie({__name:"activities",setup(ve){const S=me(),T=f(2),b=f([{adminId:0,adminName:"",contentUrl:"",endTime:"",id:0,imgUrl:"",publishTime:"",status:""}]),_=f(!1),s=f("new"),o=f({adminId:0,adminName:"",contentUrl:"",endTime:"",id:0,imgUrl:"",publishTime:"",status:""}),x=f(),Y={publishTime:[{required:!0,trigger:"blur"},{validator:h,trigger:"blur"}],endTime:[{required:!0,trigger:"blur"},{validator:h,trigger:"blur"}]};function h(d,l,i){new Date(l)<=new Date?i(new Error("必须填未来时间")):new Date(o.value.publishTime)>=new Date(o.value.endTime)?i(new Error("开始时间不能晚于结束时间")):i()}function $(){s.value="new",o.value={adminId:0,adminName:"",contentUrl:"",endTime:"",id:0,imgUrl:"",publishTime:"",status:""},_.value=!0}function M(d){var l=JSON.parse(JSON.stringify(b.value[d]));l.publishTime=k(l.publishTime),l.endTime=k(l.endTime),o.value=l,s.value="update",_.value=!0}function y(){_.value=!1}function O(){var d;(d=x.value)==null||d.validate(l=>{if(l==!0)if(s.value=="new"){var i=JSON.parse(JSON.stringify(o.value));delete i.adminId,delete i.id,delete i.status,V.post("/admin/activity/add",i).then(n=>{n.data.code==1?(y(),v(),p.success("保存成功")):p.error(`保存失败: ${n.data.msg}`)})}else s.value=="update"&&V.post("/admin/activity/update",o.value).then(n=>{n.data.code==1?(y(),v(),p.success("保存成功")):p.error(`保存失败: ${n.data.msg}`)})})}function R(d){var l=b.value[d].id;V.delete("/admin/activity/delete",{params:{ids:l}}).then(i=>{i.data.code==1?(v(),p.success("删除成功")):p.error(`删除失败: ${i.data.msg}`)})}function v(){V.get("/admin/activity/list",{params:{status:T.value}}).then(d=>{if(d.data.data===null){S.push("/login");return}b.value=d.data.data}).catch(()=>{p.error("数据加载失败")})}return de(()=>{v()}),(d,l)=>{const i=j,n=P,B=K,r=L,H=oe,J=Q,c=ee,m=le,I=te,N=W,A=X,F=ae,z=Z;return ue(),ne(re,null,[g("div",se,[g("div",pe,[e(i,{type:"primary",icon:w(G),onClick:$},{default:t(()=>[u("新增活动")]),_:1},8,["icon"]),e(B,{modelValue:T.value,"onUpdate:modelValue":l[0]||(l[0]=a=>T.value=a),onChange:v,style:{width:"120px"}},{default:t(()=>[e(n,{label:"所有活动",value:2}),e(n,{label:"未发布",value:0}),e(n,{label:"已发布",value:1})]),_:1},8,["modelValue"])]),e(J,{data:b.value,"table-layout":"auto"},{default:t(()=>[e(r,{prop:"id",label:"ID"}),e(r,{prop:"adminId",label:"adminId"}),e(r,{prop:"adminName",label:"管理员"}),e(r,{prop:"contentUrl",label:"活动链接"}),e(r,{prop:"imgUrl",label:"图片"}),e(r,{prop:"publishTime",label:"开始时间"},{default:t(a=>[u(U(w(C)(a.row.publishTime)),1)]),_:1}),e(r,{prop:"endTime",label:"结束时间"},{default:t(a=>[u(U(w(C)(a.row.endTime)),1)]),_:1}),e(r,{prop:"status",label:"状态"},{default:t(a=>[e(H,{type:a.row.status==1?"success":"danger"},{default:t(()=>[u(U(a.row.status==1?"已发布":"未发布"),1)]),_:2},1032,["type"])]),_:1}),e(r,{label:"操作",fixed:"right"},{default:t(a=>[g("div",fe,[e(i,{link:"",type:"primary",size:"small",onClick:q=>M(a.$index)},{default:t(()=>[u("编辑")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",size:"small",onClick:q=>R(a.$index)},{default:t(()=>[u("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),e(z,{modelValue:_.value,"onUpdate:modelValue":l[9]||(l[9]=a=>_.value=a),title:`编辑 "${o.value.adminName}"`},{footer:t(()=>[g("div",_e,[e(i,{onClick:y},{default:t(()=>[u("取消")]),_:1}),e(i,{type:"primary",onClick:O},{default:t(()=>[u("保存")]),_:1})])]),default:t(()=>[e(F,{"label-width":"auto","label-position":"left",model:o.value,rules:Y,ref_key:"editorRef",ref:x},{default:t(()=>[E(e(m,{label:"adminId"},{default:t(()=>[e(c,{modelValue:o.value.adminId,"onUpdate:modelValue":l[1]||(l[1]=a=>o.value.adminId=a)},null,8,["modelValue"])]),_:1},512),[[D,s.value=="update"]]),e(m,{label:"管理员"},{default:t(()=>[e(c,{modelValue:o.value.adminName,"onUpdate:modelValue":l[2]||(l[2]=a=>o.value.adminName=a)},null,8,["modelValue"])]),_:1}),e(m,{label:"活动链接"},{default:t(()=>[e(c,{modelValue:o.value.contentUrl,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.contentUrl=a)},null,8,["modelValue"])]),_:1}),e(m,{label:"图片"},{default:t(()=>[e(c,{modelValue:o.value.imgUrl,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.imgUrl=a)},null,8,["modelValue"])]),_:1}),e(m,{label:"开始时间",prop:"publishTime"},{default:t(()=>[e(I,{modelValue:o.value.publishTime,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.publishTime=a),type:"datetime","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1}),e(m,{label:"结束时间",prop:"endTime"},{default:t(()=>[e(I,{modelValue:o.value.endTime,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.endTime=a),type:"datetime","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1}),E(e(m,{label:"状态"},{default:t(()=>[e(A,{modelValue:o.value.status,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.status=a)},{default:t(()=>[e(N,{label:0},{default:t(()=>[u("未发布")]),_:1}),e(N,{label:1},{default:t(()=>[u("已发布")]),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[D,s.value=="update"]]),E(e(m,{label:"ID"},{default:t(()=>[e(c,{modelValue:o.value.id,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.id=a)},null,8,["modelValue"])]),_:1},512),[[D,s.value=="update"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}});export{he as default};
