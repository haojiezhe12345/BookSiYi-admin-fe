import{D as j}from"./base-bb3a9cd4.js";import{E as A,a as G,g as K,b as L,c as q,e as H,h as Q}from"./table-column-f50dbfa4.js";import{b as W,E as X,a as Y,c as ee}from"./input-0dfebaa5.js";import"./scrollbar-cd73b27d.js";import"./popper-f3ef1ed3.js";import{E as le}from"./pagination-07fe6fb6.js";import"./tooltip-15a256c2.js";import{E as m,a as ae}from"./text-f58459f4.js";import{d as te,r as p,o as oe,b as N,c as S,e as g,f as e,w as t,g as u,k as de,J as C,F as z,K as ue,z as ne,A as re,u as ie,a as y,i as pe}from"./index-7c7dea94.js";import"./aria-60e0cdc6.js";const se={style:{display:"flex","flex-direction":"column",height:"100%"}},me={style:{display:"flex",gap:"8px",padding:"8px"}},ce=["src"],fe={style:{"text-wrap":"nowrap"}},_e={style:{flex:"auto"}},ke=te({__name:"goods",setup(ve){const D=ie(),x=p(1),I=p(10),k=p(0),b=p([{categoryId:0,description:"",displayOrder:0,id:0,points:0,price:0,productImg:"",productName:"",productZone:0,status:0}]),f=p(!1),_=p("new"),o=p({categoryId:0,description:"",displayOrder:0,id:0,points:0,price:0,productImg:"",productName:"",productZone:0,status:0}),w=p([{categoryName:"dummy",id:1}]);function O(){_.value="new",o.value={categoryId:0,description:"",displayOrder:0,id:0,points:0,price:0,productImg:"",productName:"",productZone:0,status:0},f.value=!0}function $(d){o.value=JSON.parse(JSON.stringify(b.value[d])),_.value="update",f.value=!0}function E(){f.value=!1}function Z(){if(_.value=="new"){var d=JSON.parse(JSON.stringify(o.value));delete d.id,y.post("/admin/product/add",d).then(a=>{a.data.code==1?(E(),c(),m.success("保存成功")):m.error(`保存失败: ${a.data.msg}`)})}else _.value=="update"&&y.put("/admin/product/update",o.value).then(a=>{a.data.code==1?(E(),c(),m.success("保存成功")):m.error(`保存失败: ${a.data.msg}`)})}function B(d){var a=b.value[d].id;y.delete("/admin/product/delete",{data:[a]}).then(i=>{i.data.code==1?(c(),m.success("删除成功")):m.error(`删除失败: ${i.data.msg}`)})}function c(){y.post("/admin/product/getPdInfo",{pageNo:x.value,pageSize:I.value}).then(d=>{if(d.data.data===null){D.push("/login");return}b.value=d.data.records,k.value=d.data.total}).catch(()=>{m.error("数据加载失败")}),y.get("/admin/category/getPcInfo").then(d=>{w.value=d.data.data})}return oe(()=>{c()}),(d,a)=>{const i=W,n=A,T=ae,J=G,P=le,s=X,r=Y,F=Q,h=K,v=L,U=q,R=ee,M=H;return N(),S(z,null,[g("div",se,[g("div",me,[e(i,{type:"primary",icon:de(j),onClick:O},{default:t(()=>[u("新增商品")]),_:1},8,["icon"])]),e(J,{data:b.value,"table-layout":"auto"},{default:t(()=>[e(n,{prop:"id",label:"ID"}),e(n,{prop:"productImg",label:"图片"},{default:t(l=>[g("img",{style:{"max-width":"96px","max-height":"96px"},src:l.row.productImg},null,8,ce)]),_:1}),e(n,{prop:"productName",label:"名称"}),e(n,{prop:"description",label:"描述"}),e(n,{prop:"price",label:"价格"}),e(n,{prop:"categoryId",label:"分类"},{default:t(l=>[u(C((()=>{for(let V of w.value)if(V.id==l.row.categoryId)return V.categoryName})()),1)]),_:1}),e(n,{prop:"displayOrder",label:"展示优先级"}),e(n,{prop:"points",label:"所需积分"}),e(n,{prop:"productZone",label:"专区"},{default:t(l=>[u(C(["普通","积分","会员"][l.row.productZone]),1)]),_:1}),e(n,{prop:"status",label:"状态"},{default:t(l=>[e(T,{type:l.row.status==1?"success":"danger"},{default:t(()=>[u(C(l.row.status==1?"已上架":"未上架"),1)]),_:2},1032,["type"])]),_:1}),e(n,{label:"操作",fixed:"right"},{default:t(l=>[g("div",fe,[e(i,{link:"",type:"primary",size:"small",onClick:V=>$(l.$index)},{default:t(()=>[u("编辑")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",size:"small",onClick:V=>B(l.$index)},{default:t(()=>[u("删除")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),e(P,{style:{padding:"8px"},"current-page":x.value,"onUpdate:currentPage":a[0]||(a[0]=l=>x.value=l),"page-size":I.value,"onUpdate:pageSize":a[1]||(a[1]=l=>I.value=l),"page-sizes":[10,25,50,100],layout:"total, sizes, prev, pager, next, jumper",total:k.value,onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])]),e(M,{modelValue:f.value,"onUpdate:modelValue":a[12]||(a[12]=l=>f.value=l),title:`编辑 "${o.value.productName}"`},{footer:t(()=>[g("div",_e,[e(i,{onClick:E},{default:t(()=>[u("取消")]),_:1}),e(i,{type:"primary",onClick:Z},{default:t(()=>[u("保存")]),_:1})])]),default:t(()=>[e(R,{"label-width":"auto","label-position":"left",model:o.value},{default:t(()=>[e(r,{label:"名称"},{default:t(()=>[e(s,{modelValue:o.value.productName,"onUpdate:modelValue":a[2]||(a[2]=l=>o.value.productName=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"描述"},{default:t(()=>[e(s,{modelValue:o.value.description,"onUpdate:modelValue":a[3]||(a[3]=l=>o.value.description=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"价格"},{default:t(()=>[e(s,{modelValue:o.value.price,"onUpdate:modelValue":a[4]||(a[4]=l=>o.value.price=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"分类"},{default:t(()=>[e(h,{modelValue:o.value.categoryId,"onUpdate:modelValue":a[5]||(a[5]=l=>o.value.categoryId=l)},{default:t(()=>[(N(!0),S(z,null,ue(w.value,l=>(N(),pe(F,{label:l.categoryName,value:l.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"展示优先级"},{default:t(()=>[e(s,{modelValue:o.value.displayOrder,"onUpdate:modelValue":a[6]||(a[6]=l=>o.value.displayOrder=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"所需积分"},{default:t(()=>[e(s,{modelValue:o.value.points,"onUpdate:modelValue":a[7]||(a[7]=l=>o.value.points=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"图片"},{default:t(()=>[e(s,{modelValue:o.value.productImg,"onUpdate:modelValue":a[8]||(a[8]=l=>o.value.productImg=l)},null,8,["modelValue"])]),_:1}),e(r,{label:"专区"},{default:t(()=>[e(U,{modelValue:o.value.productZone,"onUpdate:modelValue":a[9]||(a[9]=l=>o.value.productZone=l)},{default:t(()=>[e(v,{label:0},{default:t(()=>[u("普通")]),_:1}),e(v,{label:1},{default:t(()=>[u("积分")]),_:1}),e(v,{label:2},{default:t(()=>[u("会员")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"上架状态"},{default:t(()=>[e(U,{modelValue:o.value.status,"onUpdate:modelValue":a[10]||(a[10]=l=>o.value.status=l)},{default:t(()=>[e(v,{label:0},{default:t(()=>[u("未上架")]),_:1}),e(v,{label:1},{default:t(()=>[u("已上架")]),_:1})]),_:1},8,["modelValue"])]),_:1}),ne(e(r,{label:"ID"},{default:t(()=>[e(s,{modelValue:o.value.id,"onUpdate:modelValue":a[11]||(a[11]=l=>o.value.id=l)},null,8,["modelValue"])]),_:1},512),[[re,_.value=="update"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}});export{ke as default};
